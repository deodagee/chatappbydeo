"use strict";(()=>{var e={};e.id=602,e.ids=[602],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},21587:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>_,originalPathname:()=>P,requestAsyncStorage:()=>q,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>y});var t={};s.r(t),s.d(t,{POST:()=>POST}),s(95655);var n=s(83323),a=s(54647),i=s(60187),o=s(73865),u=s(11805),p=s(70594),d=s(41366),c=s(78344),l=s(3471),g=s(52984),m=s.n(g);async function POST(e){let r=new(m())({appId:process.env.PUSHER_APP_ID||"",key:"93f5d985ede86198e0c7",secret:process.env.PUSHER_APP_SECRET||"",cluster:process.env.cluster||""});try{let{text:s,chatId:t}=await e.json(),n=await (0,l.getServerSession)(o.L);if(!n)return new Response("Unauthorized",{status:401});let[a,g]=t.split("--");if(n.user.id!==a&&n.user.id!==g)return new Response("Unauthorized",{status:401});let m=n.user.id===a?g:a,x=await (0,i.Y)("smembers",`user:${n.user.id}:friends`),h=x.includes(m);if(!h)return new Response("Unauthorized",{status:401});let q=await (0,i.Y)("get",`user:${n.user.id}`),f=JSON.parse(q),w=Date.now(),_={id:(0,c.x0)(),senderId:n.user.id,text:s,timestamp:w},y=d.O.parse(_);return await r.trigger((0,p.h)(`chat:${t}`),"incoming-message",y),await r.trigger((0,p.h)(`user:${m}:chats`),"new_message",{...y,senderImg:f.image,senderName:f.name}),await u.db.zadd(`chat:${t}:messages`,{score:w,member:JSON.stringify(y)}),new Response("OK")}catch(e){if(e instanceof Error)return new Response(e.message,{status:500});return console.error("MESSAGE SEND ERROR:",e),new Response("Internal Server Error",{status:500})}}let x=n.AppRouteRouteModule,h=new x({definition:{kind:a.x.APP_ROUTE,page:"/api/message/send/route",pathname:"/api/message/send",filename:"route",bundlePath:"app/api/message/send/route"},resolvedPagePath:"C:\\Users\\User\\Demo Apps For My Official Website\\Good Website Models\\chatappbydeo\\src\\app\\api\\message\\send\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:q,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:_,staticGenerationBailout:y}=h,P="/api/message/send/route"},70594:(e,r,s)=>{function toPusherKey(e){return e.replace(/:/g,"__")}function chatHrefConstructor(e,r){let s=[e,r].sort();return`${s[0]}--${s[1]}`}s.d(r,{M:()=>chatHrefConstructor,h:()=>toPusherKey}),s(682)},41366:(e,r,s)=>{s.d(r,{O:()=>n,T:()=>a});var t=s(45952);let n=t.z.object({id:t.z.string(),senderId:t.z.string(),text:t.z.string(),timestamp:t.z.number()}),a=t.z.array(n)}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[650,401,333,952,727,295,344,865],()=>__webpack_exec__(21587));module.exports=s})();