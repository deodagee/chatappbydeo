"use strict";(()=>{var e={};e.id=129,e.ids=[129],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},14489:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>w,originalPathname:()=>h,requestAsyncStorage:()=>g,routeModule:()=>q,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_,staticGenerationBailout:()=>P});var t={};s.r(t),s.d(t,{POST:()=>POST}),s(95655);var i=s(83323),n=s(54647),o=s(60187),a=s(73865),u=s(11805),p=s(70594),d=s(3471),c=s(45952),l=s(52984),f=s.n(l);async function POST(e){let r=new(f())({appId:process.env.PUSHER_APP_ID||"",key:"93f5d985ede86198e0c7",secret:process.env.PUSHER_APP_SECRET||"",cluster:process.env.cluster||""});try{let s=await e.json(),{id:t}=c.z.object({id:c.z.string()}).parse(s),i=await (0,d.getServerSession)(a.L);if(!i)return new Response("Unauthorized",{status:401});let n=await (0,o.Y)("sismember",`user:${i.user.id}:friends`,t);if(n)return new Response("Already friends",{status:400});let l=await (0,o.Y)("sismember",`user:${i.user.id}:incoming_friend_requests`,t);if(!l)return new Response("No friend request",{status:400});let[f,x]=await Promise.all([(0,o.Y)("get",`user:${i.user.id}`),(0,o.Y)("get",`user:${t}`)]),q=JSON.parse(f),g=JSON.parse(x);return await Promise.all([r.trigger((0,p.h)(`user:${t}:friends`),"new_friend",q),r.trigger((0,p.h)(`user:${i.user.id}:friends`),"new_friend",g),u.db.sadd(`user:${i.user.id}:friends`,t),u.db.sadd(`user:${t}:friends`,i.user.id),u.db.srem(`user:${i.user.id}:incoming_friend_requests`,t)]),new Response("OK")}catch(e){if(console.log(e),e instanceof c.z.ZodError)return new Response("Invalid request payload",{status:422});return new Response("Invalid request",{status:400})}}let x=i.AppRouteRouteModule,q=new x({definition:{kind:n.x.APP_ROUTE,page:"/api/friends/accept/route",pathname:"/api/friends/accept",filename:"route",bundlePath:"app/api/friends/accept/route"},resolvedPagePath:"C:\\Users\\User\\Demo Apps For My Official Website\\Good Website Models\\chatappbydeo\\src\\app\\api\\friends\\accept\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:_,serverHooks:m,headerHooks:w,staticGenerationBailout:P}=q,h="/api/friends/accept/route"},70594:(e,r,s)=>{function toPusherKey(e){return e.replace(/:/g,"__")}function chatHrefConstructor(e,r){let s=[e,r].sort();return`${s[0]}--${s[1]}`}s.d(r,{M:()=>chatHrefConstructor,h:()=>toPusherKey}),s(682)}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[650,401,333,952,727,295,865],()=>__webpack_exec__(14489));module.exports=s})();