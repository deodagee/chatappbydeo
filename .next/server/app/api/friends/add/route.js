"use strict";(()=>{var e={};e.id=393,e.ids=[393],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},70703:(e,r,s)=>{let t;s.r(r),s.d(r,{headerHooks:()=>y,originalPathname:()=>P,requestAsyncStorage:()=>g,routeModule:()=>_,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>v});var i={};s.r(i),s.d(i,{POST:()=>POST}),s(95655);var n=s(83323),o=s(54647),a=s(60187),u=s(73865),d=s(11805),p=s(70594),c=s(45952);let l=c.z.object({email:c.z.string().email()});console.log("add-friends.ts:Received data:",t);var f=s(3471),x=s(52984),m=s.n(x);async function POST(e){let r=new(m())({appId:process.env.PUSHER_APP_ID||"",key:"93f5d985ede86198e0c7",secret:process.env.PUSHER_APP_SECRET||"",cluster:process.env.cluster||""});try{let s=await e.json(),{email:t}=l.parse(s.email);console.log("enail to add:",t);let i=await (0,a.Y)("get",`user:email:${t}`);if(console.log("id of email to add:",i),!i)return new Response("This person does not exist.",{status:400});let n=await (0,f.getServerSession)(u.L);if(!n)return new Response("Unauthorized",{status:401});if(i===n.user.id)return new Response("You cannot add yourself as a friend",{status:400});let o=await (0,a.Y)("sismember",`user:${i}:incoming_friend_requests`,n.user.id);if(o)return new Response("Already added this user",{status:400});let c=await (0,a.Y)("sismember",`user:${n.user.id}:friends`,i);if(c)return new Response("Already friends with this user",{status:400});return await r.trigger((0,p.h)(`user:${i}:incoming_friend_requests`),"incoming_friend_requests",{senderId:n.user.id,senderEmail:n.user.email}),await d.db.sadd(`user:${i}:incoming_friend_requests`,n.user.id),new Response("OK")}catch(e){if(e instanceof c.z.ZodError)return new Response("Invalid request payload",{status:422});return console.error("eror details:",e),new Response("Invalid request",{status:400})}}let q=n.AppRouteRouteModule,_=new q({definition:{kind:o.x.APP_ROUTE,page:"/api/friends/add/route",pathname:"/api/friends/add",filename:"route",bundlePath:"app/api/friends/add/route"},resolvedPagePath:"C:\\Users\\User\\Demo Apps For My Official Website\\Good Website Models\\chatappbydeo\\src\\app\\api\\friends\\add\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:h,headerHooks:y,staticGenerationBailout:v}=_,P="/api/friends/add/route"},70594:(e,r,s)=>{function toPusherKey(e){return e.replace(/:/g,"__")}function chatHrefConstructor(e,r){let s=[e,r].sort();return`${s[0]}--${s[1]}`}s.d(r,{M:()=>chatHrefConstructor,h:()=>toPusherKey}),s(682)}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[650,401,333,952,727,295,865],()=>__webpack_exec__(70703));module.exports=s})();